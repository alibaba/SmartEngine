<?xml version="1.0" encoding="UTF-8"?>
<definitions id="alipay-forex" version="1.0.0"
             xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:smart="http://smart.alibaba-inc.com/schema/process"
             targetNamespace="Examples">

    <process id="alipay-forex-process" isExecutable="true">
        <startEvent id="theStart"></startEvent>
        <sequenceFlow id="flow1" sourceRef="theStart" targetRef="exclusivegateway1"></sequenceFlow>
        <exclusiveGateway id="exclusivegateway1" name="exclusivegateway1"></exclusiveGateway>

        <sequenceFlow id="flow2" sourceRef="exclusivegateway1" targetRef="pre_order">
            <conditionExpression type="custom"><![CDATA[smartEngineAction == "pre_order"]]></conditionExpression>
        </sequenceFlow>
        <sequenceFlow id="flow3" sourceRef="exclusivegateway1" targetRef="formal_order">
            <conditionExpression type="mvel"><![CDATA[smartEngineAction == "formal_order"]]></conditionExpression>
        </sequenceFlow>

        <sequenceFlow id="flow11" sourceRef="formal_order" targetRef="wait_money_into_account"></sequenceFlow>


        <exclusiveGateway id="exclusivegateway2" name="Exclusive Gateway"></exclusiveGateway>

        <sequenceFlow id="flow12" sourceRef="exclusivegateway2" targetRef="wait_money_into_account">
            <conditionExpression type="mvel"><![CDATA[smartEngineAction == "go_to_pay"]]></conditionExpression>
        </sequenceFlow>
        <sequenceFlow id="flow29" sourceRef="exclusivegateway2" targetRef="endevent4">
            <conditionExpression type="mvel"><![CDATA[smartEngineAction == "time_out_pay"]]></conditionExpression>
        </sequenceFlow>

        <exclusiveGateway id="exclusivegateway3" name="Exclusive Gateway"></exclusiveGateway>
        <sequenceFlow id="flow20" sourceRef="wait_money_into_account" targetRef="exclusivegateway3"></sequenceFlow>

        <sequenceFlow id="flow21" sourceRef="exclusivegateway3" targetRef="fund_delivery">
            <conditionExpression type="mvel"><![CDATA[smartEngineAction == "money_into_account"]]></conditionExpression>
        </sequenceFlow>
        <sequenceFlow id="flow27" sourceRef="exclusivegateway3" targetRef="refund">
            <conditionExpression type="mvel"><![CDATA[smartEngineAction == "money_outof_account"]]></conditionExpression>
        </sequenceFlow>


        <receiveTask id="fund_delivery" name="资金交割" smart:class="com.alibaba.smart.framework.engine.test.CreateOrderDelegation"></receiveTask>

        <receiveTask id="fund_delivery_ack" name="回执确认" smart:class="com.alibaba.smart.framework.engine.test.CreateOrderDelegation" ></receiveTask>
        <sequenceFlow id="flow22" sourceRef="fund_delivery" targetRef="fund_delivery_ack"></sequenceFlow>
        <sequenceFlow id="flow23" sourceRef="pre_order" targetRef="confirm_order"></sequenceFlow>
        <sequenceFlow id="flow24" sourceRef="confirm_order" targetRef="exclusivegateway2"></sequenceFlow>
        <receiveTask id="confirm_order" name="下单确认" smart:class="com.alibaba.smart.framework.engine.test.CreateOrderDelegation"></receiveTask>
        <receiveTask id="pre_order" name="预下单" smart:class="com.alibaba.smart.framework.engine.test.CreateOrderDelegation"></receiveTask>
        <receiveTask id="formal_order" name="正式下单" smart:class="com.alibaba.smart.framework.engine.test.CreateOrderDelegation"></receiveTask>
        <receiveTask id="wait_money_into_account" name="等待客户资金到账" smart:class="com.alibaba.smart.framework.engine.test.CreateOrderDelegation"></receiveTask>
        <endEvent id="endevent2" name="End" smart:class="com.alibaba.smart.framework.engine.test.ExceptionDelegation"></endEvent>
        <sequenceFlow id="flow26" sourceRef="fund_delivery_ack" targetRef="endevent2"></sequenceFlow>
        <receiveTask id="refund" name="资金反平处理" smart:class="com.alibaba.smart.framework.engine.test.CreateOrderDelegation"></receiveTask>
        <endEvent id="endevent3" name="End"></endEvent>
        <sequenceFlow id="flow28" sourceRef="refund" targetRef="endevent3"></sequenceFlow>
        <endEvent id="endevent4" name="End"></endEvent>
    </process>

</definitions>